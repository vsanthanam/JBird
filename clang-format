#!/bin/bash

set -e

# Check for clang-format
if ! command -v clang-format &> /dev/null; then
  echo "‚ö†Ô∏è  clang-format is not installed."

  # Check for Homebrew
  if ! command -v brew &> /dev/null; then
    echo "‚ùå Homebrew is not installed. Please install Homebrew first:"
    echo "    https://brew.sh/"
    exit 1
  fi

  # Prompt to install via Homebrew
  read -p "Would you like to install clang-format using Homebrew? [y/N] " choice
  case "$choice" in
    y|Y )
      echo "üîß Installing clang-format..."
      brew install clang-format
      ;;
    * )
      echo "‚ùå Aborting. clang-format is required."
      exit 1
      ;;
  esac
fi

# Format all .c and .h files recursively
echo "‚ú® Formatting .c and .h files"
find . -path ./\.build -prune -o -type f \( -name "*.c" -o -name "*.h" \) -exec clang-format -i "{}" +

echo "‚úÖ Formatting complete."